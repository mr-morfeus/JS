/**
 * –°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —Å WeakMap
 * 
 * –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å 4 —Ñ—É–Ω–∫—Ü–∏–∏:
 * 1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫ –æ–±—ä–µ–∫—Ç—É
 * 2. –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞
 * 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
 * 4. –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
 * 
 * –ò—Å–ø–æ–ª—å–∑—É–π WeakMap —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏!
 */

// üìä –ì–ª–æ–±–∞–ª—å–Ω–∞—è WeakMap –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
const objectMetadata = new WeakMap();

/**
 * 1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫ –æ–±—ä–µ–∫—Ç—É
 * @param {Object} obj - –ª—é–±–æ–π –æ–±—ä–µ–∫—Ç
 * @param {Object} metadata - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–æ–±—ä–µ–∫—Ç —Å –ª—é–±—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
 */

function addMetadata(obj, metadata) {
  objectMetadata.set(obj, metadata);
}

/**
 * 2. –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞
 * @param {Object} obj - –æ–±—ä–µ–∫—Ç
 * @returns {Object|null} - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ—Ç
 */
function getMetadata(obj) {
  if(objectMetadata.get(obj)){
    return objectMetadata.get(obj)
  }else{
    return null
  }
}

/**
 * 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É –æ–±—ä–µ–∫—Ç–∞
 * @param {Object} obj - –æ–±—ä–µ–∫—Ç
 * @returns {boolean} - true –µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
 */
function hasMetadata(obj) {

return objectMetadata.has(obj);

}

/**
 * 4. –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞
 * @param {Object} obj - –æ–±—ä–µ–∫—Ç
 * @returns {boolean} - —É—Å–ø–µ—à–Ω–æ –ª–∏ —É–¥–∞–ª–µ–Ω–æ
 */
function removeMetadata(obj) {
  return objectMetadata.delete(obj);

}

/**
 * 5. –ë–û–ù–£–°: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
 * @returns {Array} - –º–∞—Å—Å–∏–≤ –ø–∞—Ä [–æ–±—ä–µ–∫—Ç, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ]
 * 
 * –í–Ω–∏–º–∞–Ω–∏–µ: WeakMap –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã!
 * –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ
 */
function debugGetAllMetadata() {
  // –ù–µ –∏–∑–º–µ–Ω—è–π —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é - –æ–Ω–∞ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  return Array.from(objectMetadata.entries());
}

// üß™ –¢–ï–°–¢–ò–†–£–ï–ú
console.log("=== –¢–ï–°–¢ WeakMap –ú–ï–¢–ê–î–ê–ù–ù–´–• ===\n");

// –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
const user = { name: "–ò–≤–∞–Ω", age: 25 };
const product = { title: "–¢–µ–ª–µ—Ñ–æ–Ω", price: 1000 };
const order = { id: 1, date: "2024-01-15" };

// 1. –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
console.log("1. –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:");
addMetadata(user, { 
  created: "2024-01-10", 
  role: "admin",
  lastLogin: "2024-01-14"
});

addMetadata(product, {
  category: "—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
  stock: 50,
  rating: 4.5
});

addMetadata(order, {
  status: "completed",
  payment: "credit card"
});

console.log("‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã");

// 2. –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
console.log("\n2. –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:");
const userMeta = getMetadata(user);
console.log(userMeta); // –î–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç —Å created, role, lastLogin

// 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ
console.log("\n3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:");
console.log("–ï—Å—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É user?", hasMetadata(user)); // true
console.log("–ï—Å—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É {x:1}?", hasMetadata({x:1})); // false

// 4. –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
console.log("\n4. –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–∞:");
addMetadata(product, { ...getMetadata(product), discount: 10 });
console.log("–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–∞:", getMetadata(product));

// 5. –£–¥–∞–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
console.log("\n5. –£–¥–∞–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞:");
console.log("–î–æ —É–¥–∞–ª–µ–Ω–∏—è:", hasMetadata(order)); // true
removeMetadata(order);
console.log("–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:", hasMetadata(order)); // false

// 6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ WeakMap
console.log("\n6. –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É:");
let tempObj = { temp: true };
addMetadata(tempObj, { note: "–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" });

console.log("–î–æ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞:", hasMetadata(tempObj)); // true
console.log("–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:", getMetadata(tempObj));

// –£–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç
tempObj = null;

// –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ, –∫–æ–≥–¥–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞,
// –∑–∞–ø–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—Å—è –∏–∑ WeakMap!
console.log("–ü–æ—Å–ª–µ tempObj = null, —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ —É–¥–∞–ª–∏—Ç –∑–∞–ø–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏");

// 7. –ë–æ–Ω—É—Å: —Å–º–æ—Ç—Ä–∏–º –≤—Å–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
console.log("\n7. –í—Å–µ –æ–±—ä–µ–∫—Ç—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (debug):");
console.log(debugGetAllMetadata());

// 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å DOM —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (–µ—Å–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
console.log("\n8. –ü—Ä–∏–º–µ—Ä —Å DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–º (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ):");
// const button = document.createElement('button');
// addMetadata(button, { clicks: 0 });
// button.addEventListener('click', function() {
//   const meta = getMetadata(this);
//   meta.clicks++;
//   console.log(`–ö–ª–∏–∫–æ–≤: ${meta.clicks}`);
// });
// –ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å button –∏–∑ DOM, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—Å—Ç—è—Ç—Å—è!